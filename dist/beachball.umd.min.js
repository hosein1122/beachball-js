!function(t){"function"==typeof define&&define.amd?define(t):t()}(function(){"use strict";class t{constructor(t=0,e=0,s=0){this.val=t,this.strike=e,this.dip=s}}class e{constructor(t=0,e=0,s=0){this.strike=t,this.dip=e,this.rake=s}}class s{constructor(...t){if(2===t.length){const e=t[0];if(this.expo=t[1],Array.isArray(e)&&6===e.length)this.mt=[[e[0],e[3],e[4]],[e[3],e[1],e[5]],[e[4],e[5],e[2]]];else{if(!Array.isArray(e)||3!==e.length||!Array.isArray(e[0]))throw new TypeError("Invalid parameter size for MomentTensor.");if(3!==e.length||3!==e[0].length)throw new TypeError("Full matrix must be 3Ã—3.");this.mt=e}}else{if(7!==t.length)throw new TypeError("Wrong number of parameters for MomentTensor.");{const[e,s,a,h,i,n,r]=t;this.mt=[[e,h,i],[h,s,n],[i,n,a]],this.expo=r}}}get mtNormalized(){const t=this.mtFrobeniusNorm();return this.mt.map(e=>e.map(e=>e/t))}mtFrobeniusNorm(){return Math.sqrt(this.mt.reduce((t,e)=>t+e.reduce((t,e)=>t+e*e,0),0))}get normalized(){return new s(this.mtNormalized,this.expo)}get xx(){return this.mt[0][0]}get xy(){return this.mt[0][1]}get xz(){return this.mt[0][2]}get yy(){return this.mt[1][1]}get yz(){return this.mt[1][2]}get zz(){return this.mt[2][2]}}function a(t,e="asc"){function s(t,s){const a="asc"===e?[2,1,0]:[0,1,2];return{values:a.map(e=>t[e]),vectors:a.map(t=>function(t){const e=t.reduce((t,e,s,a)=>Math.abs(e)>Math.abs(a[t])?s:t,0);return t[e]<0?t.map(t=>-t):t}(s[t]))}}let a=0;for(let e=0;e<3;++e)for(let s=e;s<3;++s)a=Math.max(a,Math.abs(t[e][s]));if(0===a)return s([0,0,0],[[1,0,0],[0,1,0],[0,0,1]]);const h=t.map(t=>t.map(t=>t/a)),[i,n,r]=[h[0][0],h[0][1],h[0][2]],[o,l,c]=[h[1][1],h[1][2],h[2][2]],M=n*n+r*r+l*l;if(0===M)return s([i,o,c].map(t=>t*a),[[1,0,0],[0,1,0],[0,0,1]]);const p=(i+o+c)/3,f=(i-p)**2+(o-p)**2+(c-p)**2+2*M,u=Math.sqrt(f/6),m=(i-p)/u,d=n/u,g=r/u,y=(o-p)/u,b=l/u,w=(c-p)/u,P=(m*y*w+2*d*g*b-m*b*b-y*g*g-w*d*d)/2,v=Math.max(-1,Math.min(1,P)),A=Math.acos(v)/3,x=p+2*u*Math.cos(A),I=p+2*u*Math.cos(A+2*Math.PI/3),k=[x,3*p-x-I,I].map(t=>t*a),_=k.map(t=>function(t){const e=[[h[0][0]-t,h[0][1],h[0][2]],[h[1][0],h[1][1]-t,h[1][2]],[h[2][0],h[2][1],h[2][2]-t]];let s=[e[0][1]*e[1][2]-e[0][2]*e[1][1],e[0][2]*e[1][0]-e[0][0]*e[1][2],e[0][0]*e[1][1]-e[0][1]*e[1][0]],a=Math.hypot(...s);return 0===a&&(s=[e[0][1]*e[2][2]-e[0][2]*e[2][1],e[0][2]*e[2][0]-e[0][0]*e[2][2],e[0][0]*e[2][1]-e[0][1]*e[2][0]],a=Math.hypot(...s),0===a&&(s=[0,0,0],a=1)),s.map(t=>t/a)}(t/a));return s(k,_)}function h(t,e,s,a){try{if(void 0===s.length)throw new TypeError;if(2!==s.length)throw new Error("res must contain exactly two elements")}catch(t){if(!(t instanceof TypeError))throw t;s=[s,s]}return{vertices:t.map((t,h)=>[t*s[0]+a[0],e[h]*s[1]+a[1]]),res:s,center:a}}const i=Math.PI/180,n=180/Math.PI,r=1e-5;function o(t,e){const s=Array.isArray(t),a=Array.isArray(e),h=(t,e)=>[e*Math.cos(t),e*Math.sin(t)];if(!s&&!a)return h(t,e);const i=s?t:Array(e.length).fill(t),n=a?e:Array(t.length).fill(e);if(i.length!==n.length)throw new Error("pol2cart: th and r must have the same length when arrays");const r=[],o=[];for(let t=0;t<i.length;t+=1){const[e,s]=h(i[t],n[t]);r.push(e),o.push(s)}return[r,o]}function l(t,e=200,s=[0,0],a=200){try{if(void 0===a.length)throw new TypeError;if(2!==a.length)throw new Error("width must contain exactly two elements")}catch(t){if(!(t instanceof TypeError))throw t;a=[a,a]}let n=t.strike,r=t.dip,l=t.rake,c=0;l>180&&(l-=180,c=1),l<0&&(l+=180,c=1);let[M,p,f]=function(t,e,s){const a=180/Math.PI,h=(t+90)/a,i=e/a,n=s/a,r=-Math.cos(n)*Math.cos(h)-Math.sin(n)*Math.sin(h)*Math.cos(i),o=Math.cos(n)*Math.sin(h)-Math.sin(n)*Math.cos(h)*Math.cos(i),l=Math.sin(n)*Math.sin(i),[c,M]=function(t,e,s){const a=180/Math.PI;s<0&&(0!=t&&(t=-t),0!=e&&(e=-e),s=-s);let h=Math.atan2(e,t)*a;for(h-=90;h>=360;)h-=360;for(;h<0;)h+=360;const i=Math.sqrt(t*t+e*e);return[h,Math.atan2(i,s)*a]}(o,r,l),p=-o,f=r;let u=(p*(Math.sin(h)*Math.sin(i))+f*(Math.cos(h)*Math.sin(i)))/Math.sqrt(p*p+f*f);Math.abs(u)>1&&Math.abs(u)<1.0000000000000222&&(u=Math.sign(u));const m=Math.acos(u);return[c,M,l>0?m*a:-m*a]}(n,r,l);const u=e/2;r>=90&&(r=89.9999),p>=90&&(p=89.9999);const m=[];for(let t=0;t<Math.PI;t+=.01)m.push(t);const d=90-r,g=90-p,y=m.map(t=>{const e=d*d,s=Math.sin(t)**2+Math.cos(t)**2*(d*d)/8100;return Math.sqrt(e/s)}),b=m.map(t=>{const e=g*g,s=Math.sin(t)**2+Math.cos(t)**2*(g*g)/8100;return Math.sqrt(e/s)}),w=[];for(const t of[(c+1)%2,c]){let r=1;const[l,c]=o(m.map(t=>t+n*i),y);let p,f,d,g,v,A;if(1===t)n-180>M&&(r=-1),p=P(n-180,M,r),[d,g]=o(p.map(t=>t*i),Array(p.length).fill(90)),[v,A]=o(m.map(t=>t+M*i),b),f=P(M+180,n,-r);else{let t=n-180,e=M-180;e>t&&(r=-1),p=P(t,e,-r),[d,g]=o(p.map(t=>t*i),Array(p.length).fill(90)),[v,A]=o(m.map(t=>t+M*i),b),v.reverse(),A.reverse(),f=P(M,n,r)}const[x,I]=o(f.map(t=>t*i),Array(f.length).fill(90)),k=[...l,...d,...v,...x],_=[...c,...g,...A,...I],C=k.map(t=>t*u/90),T=_.map(t=>t*u/90),E=a.map(t=>t/e);w.push(h(T,C,E,s))}function P(t,e,s=1){const a=[];if(s>0)for(let h=t;h<e;h+=s)a.push(h);else for(let h=t;h>e;h+=s)a.push(h);return a}return[["b","w"],w]}class c extends HTMLElement{static get observedAttributes(){return["focal-mechanism","width","height","tension-color","bg-color","edge-color","line-width","size"]}constructor(){super();const t=this.attachShadow({mode:"open"}),e=document.createElement("style");e.textContent="\n      :host {\n        display: inline-block;\n        position: relative;\n        width: var(--bb-width, 200px);\n        height: var(--bb-height, 200px);\n      }\n      canvas {\n        width: 100%;\n        height: 100%;\n        display: block;\n      }\n    ",t.appendChild(e),this.canvas=document.createElement("canvas"),t.appendChild(this.canvas)}attributeChangedCallback(t,e,s){switch(t){case"focal-mechanism":try{this.focalMechanism=JSON.parse(s)}catch(t){}break;case"width":{const t=parseInt(s)||200;this.canvas.width=t,this.hasAttribute("height")||(this.canvas.height=t,this.style.setProperty("--bb-height",`${t}px`)),this.style.setProperty("--bb-width",`${t}px`);break}case"height":{const t=parseInt(s);this.canvas.height=t,this.style.setProperty("--bb-height",`${t}px`);break}case"tension-color":this.tensionColor=s;break;case"bg-color":this.backgroundColor=s;break;case"edge-color":this.edgeColor=s;break;case"line-width":this.lineWidth=parseFloat(s);break;case"size":this.size=Math.max(100,parseInt(s))}this._draw()}set focalMechanism(t){let h=null,i=null;if(Array.isArray(t)&&6===t.length)h=new s(...t,0),i=function(t){const{values:s,vectors:h}=a(t.mt,"asc"),i=[[h[0][0],h[1][0],h[2][0]],[h[0][1],h[1][1],h[2][1]],[h[0][2],h[1][2],h[2][2]]],n=[s[1],s[2],s[0]];let r=[[i[1][1],-i[1][2],-i[1][0]],[i[2][1],-i[2][2],-i[2][0]],[-i[0][1],i[0][2],i[0][0]]];for(let t=0;t<3;t++)r[0][t]<0&&(r[0][t]*=-1,r[1][t]*=-1,r[2][t]*=-1);const o=n.indexOf(Math.max(...n)),l=n.indexOf(Math.min(...n)),c=[(r[0][o]+r[0][l])/Math.SQRT2,(r[1][o]+r[1][l])/Math.SQRT2,(r[2][o]+r[2][l])/Math.SQRT2],M=[(r[0][o]-r[0][l])/Math.SQRT2,(r[1][o]-r[1][l])/Math.SQRT2,(r[2][o]-r[2][l])/Math.SQRT2],p=t=>Math.hypot(...t),f=c.map(t=>t/p(c)),u=0===p(M)?[NaN,NaN,NaN]:M.map(t=>t/p(M)),m=u[2]>0,d=m?u.map(t=>-t):u,g=m?f.map(t=>-t):f,[y,b,w]=function(t,e){let[s,a,h]=t;const[i,n,r]=e,o=1e-6,l=57.2957795;let c,M,p;if(Math.abs(h)<o){c=90;let t=Math.abs(s);t>1&&(t=1),M=Math.asin(t)*l;const e=-s;e>=0&&a<0&&(M=180-M),e<0&&a<=0&&(M=180+M),e<0&&a>0&&(M=360-M),p=Math.asin(Math.abs(r))*l;const h=-r;let f;f=Math.abs(s)<o?i/a:-n/s,h>=0&&f<0&&(p=180-p),h<0&&f<=0&&(p-=180),h<0&&f>0&&(p=-p)}else{-h>1&&(h=-1);const t=Math.acos(-h);c=t*l;const e=Math.sin(t);if(0===e)return;const o=-s/e,f=a/e;let u=Math.abs(o);u>1&&(u=1),M=Math.asin(u)*l,o>=0&&f<0&&(M=180-M),o<0&&f<=0&&(M=180+M),o<0&&f>0&&(M=360-M);let m,d=-r/e;u=Math.abs(d),u>1&&(u=1),p=Math.asin(u)*l,0===o?m=i/f:(m=-e*(a*h*r/(e*e)+n)/s,0===f&&(m=n/o)),d>=0&&m<0&&(p=180-p),d<0&&m<=0&&(p-=180),d<0&&m>0&&(p=-p)}return[M,c,p]}(d,g);return new e(360-y,b,180-w)}(h);else{if(!Array.isArray(t)||3!==t.length)throw new TypeError("Wrong input value for 'fm'.");i=new e(...t)}this._mt=h,this._np1=i,this._draw()}get focalMechanism(){return this._mt?this._mt:this._np1}connectedCallback(){const t=this.hasAttribute("width")?+this.getAttribute("width"):200;this.canvas.width=t,this.style.setProperty("--bb-width",`${t}px`);const e=this.hasAttribute("height")?+this.getAttribute("height"):t;this.canvas.height=e,this.style.setProperty("--bb-height",`${e}px`),this.tensionColor=this.getAttribute("tension-color")||"#87CEEB",this.backgroundColor=this.getAttribute("bg-color")||"#FFFFFF",this.edgeColor=this.getAttribute("edge-color")||"#000000",this.lineWidth=+this.getAttribute("line-width")||2,this.size=Math.max(100,+this.getAttribute("size")||100),this._draw()}_drawPatches(t,e,s,a=!0,h=!1){t.save(),t.translate(0,t.canvas.height),t.scale(1,-1),t.lineWidth=this.lineWidth,t.strokeStyle=this.edgeColor,s.forEach((s,i)=>{t.fillStyle=e[i],t.beginPath(),"ellipse"===s.type?t.ellipse(s.xy[0],s.xy[1],s.width/2,s.height/2,0,0,2*Math.PI):s.vertices.forEach(([e,s],a)=>a?t.lineTo(e,s):t.moveTo(e,s)),t.closePath(),a&&t.fill(),h&&t.stroke()}),t.restore()}_axisOnBeachball(t,e,s=90,a=20){const h=t*Math.PI/180,i=(90-e)*s/90+a,n=Math.cos(h)*i;return[Math.sin(h)*i,n]}_getFillColors(t,e){return e.map((e,s)=>"b"===t[s]?this.tensionColor:this.backgroundColor)}_draw(){if(!this._np1)return;const e=this.canvas.getContext("2d");e.fillStyle=this.backgroundColor,e.fillRect(0,0,this.canvas.width,this.canvas.height),e.lineWidth=this.lineWidth,e.strokeStyle=this.edgeColor;const s=this.canvas.width/2,o=this.canvas.height/2,c=[s,o],M=[this.canvas.width-2*e.lineWidth,this.canvas.height-2*e.lineWidth];let p,f;if(this._mt){const[u,m,d]=function(e){const{values:s,vectors:h}=a(e.mt,"asc"),i=[[h[0][0],h[1][0],h[2][0]],[h[0][1],h[1][1],h[2][1]],[h[0][2],h[1][2],h[2][2]]];let r=[Math.asin(-i[0][0]),Math.asin(-i[0][1]),Math.asin(-i[0][2])],o=[Math.atan2(i[2][0],-i[1][0]),Math.atan2(i[2][1],-i[1][1]),Math.atan2(i[2][2],-i[1][2])];for(let t=0;t<3;t++)r[t]<=0&&(r[t]=-r[t],o[t]+=Math.PI),o[t]<0&&(o[t]+=2*Math.PI),o[t]>2*Math.PI&&(o[t]-=2*Math.PI);r=r.map(t=>t*n),o=o.map(t=>t*n);const l=[0,1,2].sort((t,e)=>s[t]-s[e]),[c,M,p]=l;return[new t(s[p],o[p],r[p]),new t(s[M],o[M],r[M]),new t(s[c],o[c],r[c])]}(this._mt.normalized),g=Math.min(this.canvas.width,this.canvas.height)/2-this.lineWidth,y=0,[b,w]=this._axisOnBeachball(u.strike,u.dip,g,y),[P,v]=this._axisOnBeachball(d.strike,d.dip,g,y);if(Math.abs(m.val)<r&&Math.abs(u.val+d.val)<r){[p,f]=l(this._np1,this.size,c,M);const t=this._getFillColors(p,f);this._drawPatches(e,t,f,!0,!0)}else{[p,f]=function(t,e,s,a=200,n=!0,o=0,l=0,c=[0,0],M=200){try{if(!Array.isArray(M)||2!==M.length)throw new TypeError}catch(t){M=[M,M]}const p=[],f=[],u=M.map(t=>t/a);let m=0,d=1,g=0,y=0,b=0;const w=Array.from({length:3},()=>new Array(2).fill(0)),P=new Array(400).fill(0),v=new Array(400).fill(0),A=new Array(400).fill(0),x=new Array(400).fill(0),I=new Array(400).fill(0),k=new Array(400).fill(0),_=new Array(800).fill(0),C=new Array(800).fill(0),T=new Array(400).fill(0),E=new Array(400).fill(0),z=[t.strike,e.strike,s.strike],F=[t.dip,e.dip,s.dip],S=[t.val,e.val,s.val];let N=(S[0]+S[1]+S[2])/3;for(let t=0;t<3;t++)S[t]=S[t]-N;const W=.5*a;if(Math.abs(S[0]*S[0]+S[1]*S[1]+S[2]*S[2])<r){if(N>0){const t={type:"ellipse",xy:c,width:M[0],height:M[1]};p.push(t),f.push("b")}if(N<0){const t={type:"ellipse",xy:c,width:M[0],height:M[1]};p.push(t),f.push("w")}return[f,p]}let q,R;Math.abs(S[0])>=Math.abs(S[2])?(q=0,R=2):(q=2,R=0),n&&(N=0);const Q=-S[1]/S[q],O=N/S[q];if(O<-1)return p.push({type:"ellipse",xy:c,width:M[0],height:M[1]}),f.push("w"),[f,p];if(O>1-Q)return p.push({type:"ellipse",xy:c,width:M[0],height:M[1]}),f.push("b"),[f,p];const B=Math.sin(F[q]*i),$=Math.cos(F[q]*i),H=Math.sin(F[1]*i),J=Math.cos(F[1]*i),L=Math.sin(F[R]*i),j=Math.cos(F[R]*i),D=Math.sin(z[q]*i),G=Math.cos(z[q]*i),K=Math.sin(z[1]*i),U=Math.cos(z[1]*i),V=Math.sin(z[R]*i),X=Math.cos(z[R]*i);let Y,Z,tt=0;for(let t=0;t<360;t++){const e=t*i,s=(2+2*O)/(3+(1-2*Q)*Math.cos(2*e));if(s>1)m+=1;else{const a=Math.asin(Math.sqrt(s)),h=Math.sin(e),n=Math.cos(e),c=Math.sin(a),M=Math.cos(a),p=M*B+c*h*H+c*n*L,f=M*$*G+c*h*J*U+c*n*j*X,u=M*$*D+c*h*J*K+c*n*j*V;let m,_;Math.abs(f)<r&&Math.abs(u)<r?(m=0,_=0):(_=Math.atan2(u,f),_<0&&(_+=2*Math.PI),m=Math.acos(p/Math.sqrt(p*p+f*f+u*u))),m>Math.PI/2&&(m=Math.PI-m,_+=Math.PI,_>2*Math.PI&&(_-=2*Math.PI));const C=Math.SQRT2*Math.sin(m/2),T=Math.sin(_),E=Math.cos(_);0===t?(w[t][0]=_,P[t]=o+W*C*T,v[t]=l+W*C*E,tt=_):(Math.abs(Math.abs(_-tt)-Math.PI)<10*i&&(w[b][1]=tt,b+=1,w[b][0]=_),Math.abs(Math.abs(_-tt)-2*Math.PI)<2*i&&(tt<_?w[b][0]+=2*Math.PI:w[b][0]-=2*Math.PI),0===b?(P[d]=o+W*C*T,v[d]=l+W*C*E,d+=1):1===b?(A[g]=o+W*C*T,x[g]=l+W*C*E,g+=1):2===b&&(I[y]=o+W*C*T,k[y]=l+W*C*E,y+=1),tt=_)}}w[b][1]=tt,S[1]<0?(Y="b",Z="w"):(Y="w",Z="b");const et={type:"ellipse",xy:c,width:M[0],height:M[1]};if(p.push(et),f.push(Z),0===b)return p.push(h(P.slice(0,360),v.slice(0,360),u,c)),f.push(Y),[f,p];if(1===b){let t;for(t=0;t<d;t++)_[t]=P[t],C[t]=v[t];if(t-=1,w[0][0]-w[0][1]>Math.PI?w[0][0]-=2*Math.PI:w[0][1]-w[0][0]>Math.PI&&(w[0][0]+=2*Math.PI),w[0][0]<w[0][1]){let e=w[0][1]-i;for(;e>w[0][0];){const s=Math.sin(e),a=Math.cos(e);_[t]=o+W*s,C[t]=l+W*a,t+=1,e-=i}}else{let e=w[0][1]+i;for(;e<w[0][0];){const s=Math.sin(e),a=Math.cos(e);_[t]=o+W*s,C[t]=l+W*a,t+=1,e+=i}}for(p.push(h(_.slice(0,t),C.slice(0,t),u,c)),f.push(Y),t=0;t<g;t++)T[t]=A[t],E[t]=x[t];if(t-=1,w[1][0]-w[1][1]>Math.PI?w[1][0]-=2*Math.PI:w[1][1]-w[1][0]>Math.PI&&(w[1][0]+=2*Math.PI),w[1][0]<w[1][1]){let e=w[1][1]-i;for(;e>w[1][0];){const s=Math.sin(e),a=Math.cos(e);T[t]=o+W*s,t+=1,E[t]=l+W*a,e-=i}}else{let e=w[1][1]+i;for(;e<w[1][0];){const s=Math.sin(e),a=Math.cos(e);T[t]=o+W*s,t+=1,E[t]=l+W*a,e+=i}}return p.push(h(T.slice(0,t),E.slice(0,t),u,c)),f.push(Y),[f,p]}if(2===b){let t=0;for(t=0;t<y;t++)_[t]=I[t],C[t]=k[t];t-=1;for(let e=0;e<d;e++)_[t]=P[e],t++,C[t]=v[e];if(m){let e=g-1;for(;e>=0;)_[t]=A[e],t+=1,C[t]=x[e],e-=1;return p.push(h(_.slice(0,t),C.slice(0,t),u,c)),f.push(Y),[f,p]}if(w[2][0]-w[0][1]>Math.PI?w[2][0]-=2*Math.PI:w[0][1]-w[2][0]>Math.PI&&(w[2][0]+=2*Math.PI),w[2][0]<w[0][1]){let e=w[0][1]-i;for(;e>w[2][0];){const s=Math.sin(e),a=Math.cos(e);_[t]=o+W*s,t+=1,C[t]=l+W*a,e-=i}}else{let e=w[0][1]+i;for(;e<w[2][0];){const s=Math.sin(e),a=Math.cos(e);_[t]=o+W*s,t+=1,C[t]=l+W*a,e+=i}}for(p.push(h(_.slice(0,t),C.slice(0,t),u,c)),f.push(Y),t=0;t<g;t++)T[t]=A[t],E[t]=x[t];if(t-=1,w[1][0]-w[1][1]>Math.PI?w[1][0]-=2*Math.PI:w[1][1]-w[1][0]>Math.PI&&(w[1][0]+=2*Math.PI),w[1][0]<w[1][1]){let e=w[1][1]-i;for(;e>w[1][0];){const s=Math.sin(e),a=Math.cos(e);T[t]=o+W*s,t+=1,E[t]=l+W*a,e-=i}}else{let e=w[1][1]+i;for(;e<w[1][0];){const s=Math.sin(e),a=Math.cos(e);T[t]=o+W*s,t+=1,E[t]=l+W*a,e+=i}}return p.push(h(T.slice(0,t),E.slice(0,t),u,c)),f.push(Y),[f,p]}return[f,p]}(u,m,d,this.size,!0,0,0,c,M);const t=this._getFillColors(p,f);this._drawPatches(e,t,f,!0,!1),[p,f]=l(this._np1,this.size,c,M);const s=this._getFillColors(p,f);this._drawPatches(e,s,f,!1,!0)}const A=s+b,x=o-w,I=s+P,k=o-v;e.save(),e.font="bold 18px sans-serif",e.fillStyle="black",e.textAlign="center",e.textBaseline="middle",e.fillText("T",A,x),e.fillText("P",I,k),e.restore()}else{[p,f]=l(this._np1,this.size,c,M);const t=this._getFillColors(p,f);this._drawPatches(e,t,f,!0,!0)}}}customElements.define("beachball-component",c)});
